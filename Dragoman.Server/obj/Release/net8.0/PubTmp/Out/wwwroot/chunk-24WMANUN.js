import{a as W}from"./chunk-GRZSBS6E.js";import{$ as T,A as S,D as b,E as f,F as g,Ga as $,H as i,I as s,Ia as V,J as P,Ja as N,P as E,Q as C,W as k,X as D,ja as w,ka as I,la as y,na as j,o as O,pa as F,q as h,qa as R,r as _,ra as U,t as d,ta as A,u as x,v as p,w as m,wa as H,y as n,z as t,za as L}from"./chunk-UPQ5EB2H.js";var G=()=>({exact:!0}),J=()=>[];function z(a,c){if(a&1&&(n(0,"tr")(1,"td"),i(2),t(),n(3,"td"),i(4),t(),n(5,"td"),i(6),t(),n(7,"td"),i(8),t()()),a&2){let e=c.$implicit;d(2),s(e.heure),d(2),s(e.numero),d(2),s(e.type),d(2),s(e.dureeMin||0)}}function B(a,c){a&1&&(n(0,"tr")(1,"td",30),i(2,"\u2014"),t()())}function q(a,c){if(a&1&&(n(0,"tr")(1,"td"),i(2),t(),n(3,"td"),i(4),t()()),a&2){let e=c.$implicit;d(2),s(e.denomination),d(2),s(e.dureeMin||0)}}function K(a,c){a&1&&(n(0,"tr")(1,"td",31),i(2,"\u2014"),t()())}function Q(a,c){if(a&1&&(n(0,"div",25)(1,"h4"),i(2,"Tickets"),t(),n(3,"table",26)(4,"thead")(5,"tr")(6,"th"),i(7,"Heure"),t(),n(8,"th"),i(9,"N\xB0"),t(),n(10,"th"),i(11,"Description"),t(),n(12,"th"),i(13,"Dur\xE9e (min)"),t()()(),n(14,"tbody"),p(15,z,9,4,"tr",19)(16,B,3,0,"tr",27),t()(),n(17,"h4"),i(18,"Autres t\xE2ches"),t(),n(19,"table",26)(20,"thead")(21,"tr")(22,"th"),i(23,"Description"),t(),n(24,"th"),i(25,"Dur\xE9e (min)"),t()()(),n(26,"tbody"),p(27,q,5,2,"tr",19)(28,K,3,0,"tr",27),t()(),n(29,"div",28)(30,"label"),i(31,"Remarques"),t(),n(32,"div",29),i(33),t()()()),a&2){let e=g().$implicit;d(15),m("ngForOf",(e.data==null?null:e.data.hdTickets)||C(5,J)),d(),m("ngIf",!(!(e.data==null||e.data.hdTickets==null)&&e.data.hdTickets.length)),d(11),m("ngForOf",(e.data==null?null:e.data.hdAutresTaches)||C(6,J)),d(),m("ngIf",!(!(e.data==null||e.data.hdAutresTaches==null)&&e.data.hdAutresTaches.length)),d(5),s((e.data==null?null:e.data.hdRemarquesCollaborateur)||"\u2014")}}function X(a,c){if(a&1){let e=b();n(0,"div")(1,"div",20)(2,"div",21),i(3),t(),n(4,"div",22)(5,"span",23),i(6),t(),n(7,"button",13),f("click",function(){let o=h(e).$implicit;return _(o.ouvert=!o.ouvert)}),i(8),t()()(),p(9,Q,34,7,"div",24),t()}if(a&2){let e=c.$implicit,r=g(2);d(3),s(e.nom),d(3),P("",r.totalJourMinutes(e)," min"),d(2),s(e.ouvert?"\uFE3F":"\uFE40"),d(),m("ngIf",e.ouvert)}}function Z(a,c){if(a&1){let e=b();n(0,"div",8)(1,"h2"),i(2,"Fiche Helpdesk \u2014 R\xE9cap semaine"),t(),n(3,"div",9),i(4," Utilisateur: "),n(5,"b"),i(6),t(),i(7," \u2022 Semaine: "),n(8,"b"),i(9),t()(),n(10,"form",10)(11,"label"),i(12,"Semaine"),t(),S(13,"input",11),n(14,"div",12)(15,"button",13),f("click",function(){h(e);let o=g();return _(o.toggleAll(!0))}),i(16,"Tout replier"),t(),n(17,"button",14),f("click",function(){h(e);let o=g();return _(o.telechargerWord())}),i(18,"Exporter Word"),t()()(),n(19,"div",15)(20,"div",16)(21,"div",17),i(22),t(),n(23,"div",18),i(24,"Minutes tickets"),t()(),n(25,"div",16)(26,"div",17),i(27),t(),n(28,"div",18),i(29,"Minutes autres t\xE2ches"),t()(),n(30,"div",16)(31,"div",17),i(32),t(),n(33,"div",18),i(34,"Total minutes"),t()()(),p(35,X,10,4,"div",19),t()}if(a&2){let e=g();d(6),s(e.user),d(3),s(e.semaineISO),d(),m("formGroup",e.formulaire),d(7),m("disabled",!e.jours.length),d(5),s(e.totalMinutesTickets()),d(5),s(e.totalMinutesAutres()),d(5),s(e.totalMinutes()),d(3),m("ngForOf",e.jours)}}function Y(){let a=new Date,c=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate())),e=(c.getUTCDay()+6)%7;c.setUTCDate(c.getUTCDate()-e+3);let r=new Date(Date.UTC(c.getUTCFullYear(),0,4)),o=(c.getTime()-r.getTime())/864e5,l=1+Math.floor(o/7);return`${c.getUTCFullYear()}-W${l.toString().padStart(2,"0")}`}function v(a){return a&&a>0?a:0}function ee(a){let c=parseInt(a.slice(0,4),10),e=parseInt(a.slice(6),10),r=new Date(Date.UTC(c,0,4)),o=(r.getUTCDay()+6)%7,l=new Date(r);l.setUTCDate(r.getUTCDate()-o);let u=new Date(l);return u.setUTCDate(l.getUTCDate()+(e-1)*7),new Date(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate())}function te(a){let c=e=>e.toString().padStart(2,"0");return`${a.getFullYear()}-${c(a.getMonth()+1)}-${c(a.getDate())}`}var ue=(()=>{class a{constructor(e,r,o){this.fb=e,this.auth=r,this.svc=o,this.user="",this.semaineISO="",this.donnees=[],this.jours=[],this.chargement=!1,this.message=""}ngOnInit(){this.auth.getLogin().subscribe(e=>{this.user=e||"anonymous";let r=Y();this.semaineISO=r,this.formulaire=this.fb.group({hdSemaine:new U(r,{nonNullable:!0})}),this.onSemaineChange(),this.formulaire.get("hdSemaine").valueChanges.subscribe(()=>this.onSemaineChange())})}onSemaineChange(){this.message="";let e=this.formulaire.get("hdSemaine").value;this.semaineISO=e||Y(),this.initialiserJours(this.semaineISO),this.chargerSemaine()}initialiserJours(e){let r=ee(e),o=["Lundi","Mardi","Mercredi","Jeudi","Vendredi"];this.jours=o.map((l,u)=>{let M=new Date(r);return M.setDate(r.getDate()+u),{nom:l,dateISO:te(M),data:void 0,ouvert:u===0}})}chargerSemaine(){this.chargement=!0,this.svc.lireSemaine(this.user,this.semaineISO).subscribe({next:e=>{this.donnees=(e||[]).sort((o,l)=>o.hdDate.localeCompare(l.hdDate));let r=new Map(this.donnees.map(o=>[o.hdDate,o]));this.jours.forEach(o=>o.data=r.get(o.dateISO)),this.chargement=!1},error:e=>{this.message=`Erreur: ${e instanceof Error?e.message:String(e)}`,this.chargement=!1}})}totalJourMinutes(e){let r=(e.data?.hdTickets||[]).reduce((l,u)=>l+v(u.dureeMin),0),o=(e.data?.hdAutresTaches||[]).reduce((l,u)=>l+v(u.dureeMin),0);return r+o}totalMinutesTickets(){return this.jours.reduce((e,r)=>e+(r.data?.hdTickets||[]).reduce((o,l)=>o+v(l.dureeMin),0),0)}totalMinutesAutres(){return this.jours.reduce((e,r)=>e+(r.data?.hdAutresTaches||[]).reduce((o,l)=>o+v(l.dureeMin),0),0)}totalMinutes(){return this.totalMinutesTickets()+this.totalMinutesAutres()}toggleAll(e){this.jours.forEach(r=>r.ouvert=!e)}telechargerWord(){this.svc.telechargerSemaineWord(this.user,this.semaineISO).subscribe(e=>{let r=URL.createObjectURL(e),o=document.createElement("a");o.href=r,o.download=`FicheHelpdesk_${this.user}_${this.semaineISO}.docx`,o.click(),URL.revokeObjectURL(r)})}static{this.\u0275fac=function(r){return new(r||a)(x($),x(N),x(W))}}static{this.\u0275cmp=O({type:a,selectors:[["app-hd-recap-semaine"]],standalone:!0,features:[E],decls:14,vars:3,consts:[["role","navigation","aria-label","Helpdesk navigation",1,"navbar--glass"],[1,"nav-left"],[1,"logo"],["routerLink","/hd","routerLinkActive","active",3,"routerLinkActiveOptions"],["routerLink","/hd/fiche-jour","routerLinkActive","active"],["routerLink","/hd/recap-semaine","routerLinkActive","active"],[1,"nav-right"],["class","hd-carte",4,"ngIf"],[1,"hd-carte"],[1,"hd-meta"],[1,"hd-barre",3,"formGroup"],["type","week","formControlName","hdSemaine"],[1,"hd-actions-droite"],["type","button",3,"click"],["type","button",3,"click","disabled"],[1,"hd-kpis"],[1,"kpi"],[1,"v"],[1,"l"],[4,"ngFor","ngForOf"],[1,"jour-header"],[1,"title"],[1,"right"],[1,"muted"],["class","jour-card",4,"ngIf"],[1,"jour-card"],[1,"hd-table"],[4,"ngIf"],[1,"row"],[1,"ro","pre"],["colspan","4",1,"muted"],["colspan","2",1,"muted"]],template:function(r,o){r&1&&(n(0,"nav",0)(1,"div",1)(2,"span",2),i(3,"Helpdesk CCE"),t(),n(4,"a",3),i(5,"HD"),t(),n(6,"a",4),i(7,"Prestation journali\xE8re"),t(),n(8,"a",5),i(9,"Semaine"),t()(),n(10,"div",6)(11,"span"),i(12,"Bienvenue"),t()()(),p(13,Z,36,8,"div",7)),r&2&&(d(4),m("routerLinkActiveOptions",C(2,G)),d(9),m("ngIf",o.formulaire))},dependencies:[T,k,D,V,A,j,F,R,H,L,y,w,I],styles:[".hd-wrap[_ngcontent-%COMP%], .hd-carte[_ngcontent-%COMP%]{background:#fff;border-radius:14px;padding:22px;box-shadow:0 8px 24px #0000000f;border:1px solid #e5e7eb}.hd-title[_ngcontent-%COMP%]{margin:0 0 10px;font-size:22px}.hd-about[_ngcontent-%COMP%], .hd-meta[_ngcontent-%COMP%]{margin:8px 0 20px;line-height:1.5;color:#374151;opacity:.9}.hd-about[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:#f3f4f6;padding:2px 6px;border-radius:6px}.hd-barre[_ngcontent-%COMP%], .hd-ligne[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;margin:10px 0;flex-wrap:wrap}.hd-barre[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .hd-ligne[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:180px;font-weight:600}.hd-barre[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .hd-barre[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .hd-barre[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .hd-ligne[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .hd-ligne[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .hd-ligne[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{flex:1;padding:8px 10px;border:1px solid #e5e7eb;border-radius:8px;outline:none}.hd-kpis[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin:8px 0 16px}.kpi[_ngcontent-%COMP%]{background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px;padding:12px 14px}.kpi[_ngcontent-%COMP%]   .v[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.kpi[_ngcontent-%COMP%]   .l[_ngcontent-%COMP%]{color:#6b7280;font-size:12px}.jour-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(270deg,#1e3a8a,#2563eb,#1d4ed8);color:#fff;padding:10px 14px;border-radius:10px;margin:12px 0 6px;box-shadow:0 3px 10px #00000014}.jour-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px}.jour-header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px}.jour-header[_ngcontent-%COMP%]   .muted[_ngcontent-%COMP%]{color:#eef2ff;opacity:.95}.jour-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px 8px;border-radius:8px;border:1px solid rgba(255,255,255,.35);background:#ffffff2e;color:#fff;cursor:pointer}.jour-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:12px;margin-bottom:10px}.hd-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin:8px 0 14px}.hd-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .hd-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e5e7eb;padding:8px}.hd-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8fafc;text-align:left}.ro.pre[_ngcontent-%COMP%]{background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;padding:8px 10px;white-space:pre-wrap}.hd-actions[_ngcontent-%COMP%], .hd-actions-droite[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}.hd-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .hd-actions-droite[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 14px;border-radius:8px;border:none;background:#2563eb;color:#fff;cursor:pointer}.hd-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2), .hd-actions-droite[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){background:#334155}.hd-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled, .hd-actions-droite[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}@media (max-width: 700px){.hd-barre[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .hd-ligne[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100%}}"]})}}return a})();export{ue as HDRecapSemaineComponent};
